## Research Navigator v0.7.0 Roadmap

目标：统一交互与视觉、简化流程、明确模型分工、提升报告与关系图生成质量。

### 1) UI/UX 改造

- 文献详情 Overlay（右侧上层覆盖）
  - 行为：点击文献（文库/图谱/会话）在右侧以 Overlay Drawer 打开，背景 `backdrop-blur`，**不挤压主布局**。
  - 交互：Esc/点击蒙层关闭；支持路由/状态直链（可分享/返回）。
  - 动效：进入/退出过渡（250–300ms），滚动独立。
  - 适配：统一一个 `OverlayPanel` 组件，被文库与图谱共用，减少双处适配。
  - 验收：不同入口点击同一文献打开同一详情视图；主界面布局不变化；移动端占满屏。

- 研究会话卡片统一
  - 统一使用 UI 库的卡片容器（Header/Body/Footer），支持流式填充与 Skeleton。
  - 卡片类型：研究方向、搜索/扩展进度、确认（需最小化显示）、报告、提示/操作等。
  - Markdown 支持：报告卡片使用 `react-markdown`（或现有 MD 渲染器），代码块、表格、列表、内联公式。
  - 颜色：研究方向卡片保留主题色；其余遵循语义色（info/success/warn）。
  - 验收：所有卡片风格一致、支持流式更新、报告正文正确渲染 Markdown。

- 图谱窗格可收放
  - 行为：在会话页面提供“图谱”侧窗 Toggle；任一阶段均可展开/收起。
  - 状态：每会话独立持久化 `graphPanelOpen`；阶段切换仅改变默认展开状态，不强制隐藏。
  - 验收：用户手动开关与阶段默认值不冲突；刷新后恢复最近一次选择。

- 会话列表改造
  - 新建会话按钮：移入列表第一个条目，保持显著 CTA。
  - 列表项：显示标题、最近时间、当前选中高亮、右侧叉号快删（×）。
  - 排序：支持拖拽排序（dnd-kit），顺序持久化。
  - 验收：拖拽排序生效；删除有确认；当前项有清晰高亮；新建在顶部。
  - 顶部栏右上角的新建会话去掉

- 图谱中心吸引
  - 图谱中间靠右一点加上吸引力，确保页面大小切换时节点能保留在合适位置
  - 加一个设置项，可以动态开启关闭节点与节点，节点与边之间的纵向力
  - 借助纵向力设置项，实现拖动时其他节点会上下避让拖动节点，松手时所有节点应该停留在精准的时间线上的效果

### 2) 运行流程自动化

- 阶段串联（默认自动，无需按钮）
  1. 方向确认 → 自动开始集合扩展（StartExpansion）
  2. 扩展停止条件：
     - `EXPANSION_MAX_ROUNDS` 达到；或
     - 最近一轮新增为 0；或
     - 集合总量超过 `COLLECTION_UPPER_BOUND`
  3. 超上限自动裁剪：`PruneCollection(targetMax=PRUNE_TARGET_MAX, rule=citation_low_first)`
  4. 扩展/裁剪完成 → 自动构建关系图（BuildGraph(window=GRAPH_WINDOW_SIZE)）
  - 验收：确认方向后无需手动点击，流程能自动走完；各阈值可由 `runtimeConfig` 调整。

- 噪声信息抑制
  - 系统事件如“已确认方向”“开始扩展”“扩展已停止”不在聊天区展示，改入状态提示或小型 Badge。
  - 保留必要的人类可读进度，隐藏冗余重复段落。
  - 验收：对话区不再出现系统冗余段落；进度通过轻量 UI 呈现。

- DeepResearch 单一主流程
  - 当前如果开启 Deep Research 会同时触发普通对话和研究方向提案生成。
  - 若开启 deepresearch：仅启动“研究主流程”，不再并发常规对话生成研究方向。
  - 验收：同一 Query 不会触发两套并行流程。

- 当前若搜索到的论文已在文库，会意外触发扩展已停止（原因：max_rounds）

### 3) 模型分工策略（Thinking vs Task）

- Thinking Model（推理/生成型，温度中等，长上下文）
  - 研究方向提案与确认
  - 关系图“关系提案”文本（先思考后结构化）
  - 报告多阶段：大纲→分节扩写→摘要重写

- Task Model（工具/检索/解析，确定性更高）
  - 查询生成与搜索、元数据读取、集合裁剪、关系文本到边结构解析

- 配置
  - 在 `runtimeConfig` 增加 `MODELS = { thinking: '...', task: '...' }` 与温度参数。
  - 验收：关键节点调用对应模型；可一处切换。

### 4) 提示词与生成链路

- 关系图生成（替换启发式占位）
  - 输入：当前图窗口内节点 `{id, title, firstAuthor, year, key}`（key 来自报告引用映射或等价生成）。
  - 步骤：
    1) Thinking：对节点语义分群与关系假设（不输出边）。
    2) Thinking：产出候选关系说明（文本，含理由与证据字段）。
    3) Task：将文本转为结构化边数组：`{sourceId, targetId, relation, rationale}`。
  - 输出：去重、合法性校验（端点均存在），批量写入图。
  - 验收：能生成非空边；相同对重复提交不会爆炸；复杂度在窗口大小内可控。

- 报告生成多阶段
  - 1) 大纲：基于图谱结构与方向，生成章节树与每节要点（Thinking）。
  - 2) 分节扩写：按大纲逐节生成，带 cite 键位（Thinking）。
  - 3) 摘要：回看全文后重写摘要（Thinking）。
  - 渲染：拼接时保持章节顺序；References 仍由系统渲染，正文只用 `[@key]`。
  - 验收：报告质量较现有直出明显提升（结构更清晰、引用更稳定）。

### 5) 体验细节

- 会话标题自动生成
  - 在接收用户 Query 后，用 Task 模型生成 6–10 字简短标题，写入会话（可手改）。
  - 验收：标题生成稳定、无敏感词；多语言输入时能产出中文题名（可配置）。

- 卡片流式与状态
  - 统一 `StreamCard`：`idle | streaming | done | error`，均支持 Skeleton 与进度条。
  - 验收：长任务期间，用户可以实时看到内容逐步填充。

### 6) 配置与开关

在 `runtime-config.ts` 补充：

```ts
export const runtimeConfig = {
  EXPANSION_MAX_ROUNDS: 4,
  EXPANSION_ROUND_SIZE: 8,
  COLLECTION_UPPER_BOUND: 50,
  PRUNE_TARGET_MAX: 50,
  GRAPH_WINDOW_SIZE: 50,
  MODELS: { thinking: 'gpt-4.1', task: 'gpt-4o-mini' },
  TITLE_GEN_LOCALE: 'zh-CN',
  UI: { defaultGraphOpen: true }
} as const;
```

### 7) 里程碑

1. 文献详情 Overlay 与会话列表改造（UI 统一基础设施）
2. 会话页卡片统一与图谱窗格收放
3. 自动化流程打通（方向→扩展→裁剪→建图）与噪声抑制
4. 关系图提示词与结构化生成落地
5. 报告多阶段生成链路
6. 调参与打磨，完善验收与回归用例

—— 本文档随实现同步更新具体接口与组件命名。


