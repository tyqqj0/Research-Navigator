# ğŸ“š æ–‡çŒ®ç®¡ç†ç³»ç»Ÿåº•å±‚æ¶æ„æ·±åº¦åˆ†æä¸é‡æ„æ–¹æ¡ˆ

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-01-30  
> **çŠ¶æ€**: ğŸ”„ æ¶æ„åˆ†æå®Œæˆï¼Œå¾…é‡æ„å®æ–½

---

## ğŸ“‹ ç›®æ ‡æ¦‚è¿°

åŸºäºåŸæœ‰ `old/` ç›®å½•çš„æ–‡çŒ®ç®¡ç†ç³»ç»Ÿï¼Œåœ¨æ–°çš„ **Feature-First æ¶æ„** ä¸‹é‡æ–°è®¾è®¡åº•å±‚æ•°æ®è®¿é—®å±‚ï¼Œå®ç°ï¼š

1. **åŠŸèƒ½å®Œæ•´æ€§** - ä¿ç•™æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
2. **æ¶æ„ç°ä»£åŒ–** - è¿ç§»åˆ°é¢†åŸŸé©±åŠ¨è®¾è®¡
3. **ç±»å‹å®‰å…¨** - å®Œæ•´TypeScript + Zodæ”¯æŒ
4. **æ€§èƒ½ä¼˜åŒ–** - IndexedDB + Zustandæœ€ä½³å®è·µ

---

## ğŸ” åŸæœ‰æ¶æ„æ·±åº¦åˆ†æ

### ğŸ“Š æ ¸å¿ƒæ¶æ„ç‰¹ç‚¹

#### âœ… **æ¶æ„ä¼˜åŠ¿**
1. **åˆ†å±‚æ¸…æ™°** - UI â†’ State â†’ Service â†’ Data å››å±‚æ¶æ„
2. **æ•°æ®æŒä¹…åŒ–** - åŸºäºDexie.jsçš„IndexedDBæ–¹æ¡ˆ
3. **ç±»å‹å®‰å…¨** - Zod Schema + TypeScriptå…¨é“¾è·¯
4. **æ™ºèƒ½å»é‡** - MatchingEngineæ™ºèƒ½æŸ¥é‡æœºåˆ¶
5. **å¼•æ–‡ç®¡ç†** - CitationLinkerè‡ªåŠ¨å¼•æ–‡é“¾æ¥
6. **ç‰ˆæœ¬è¿ç§»** - å®Œå–„çš„æ•°æ®åº“ç‰ˆæœ¬å‡çº§æœºåˆ¶

#### ğŸ“¦ **æ ¸å¿ƒæ¨¡å—ç»“æ„**
```
old/src/libs/db/
â”œâ”€â”€ schema.ts           # Zodæ•°æ®æ¨¡å‹ (LibraryItem, Citation, LiteratureTree)
â”œâ”€â”€ index.ts            # Dexieæ•°æ®åº“å®ä¾‹å’Œç‰ˆæœ¬ç®¡ç†
â”œâ”€â”€ constants.ts        # æ–‡çŒ®æ¥æºç±»å‹å’Œå…ƒæ•°æ®
â”œâ”€â”€ LibraryService.ts   # ä¸»è¦æ•°æ®è®¿é—®æœåŠ¡ (1000+ lines)
â””â”€â”€ matching/           # æ™ºèƒ½åŒ¹é…æ¨¡å—
    â”œâ”€â”€ MatchingEngine.ts      # æ™ºèƒ½æŸ¥é‡å¼•æ“
    â”œâ”€â”€ CitationLinker.ts      # å¼•æ–‡é“¾æ¥å™¨
    â”œâ”€â”€ ReferenceExtractor.ts  # å¼•ç”¨æå–å™¨
    â””â”€â”€ SimilarityCalculator.ts # ç›¸ä¼¼åº¦è®¡ç®—å™¨
```

### ğŸ“‹ æ ¸å¿ƒæ•°æ®æ¨¡å‹

#### **LibraryItem (æ–‡çŒ®æ¡ç›®)**
```typescript
interface LibraryItem {
  id: string;                          // UUIDä¸»é”®
  title: string;                       // æ ‡é¢˜
  authors: string[];                   // ä½œè€…åˆ—è¡¨
  year: number;                        // å‘è¡¨å¹´ä»½
  source: LiteratureSource;            // æ¥æº (manual|search|import|knowledge|zotero)
  
  // å…ƒæ•°æ®
  publication?: string;                // æœŸåˆŠ/å‡ºç‰ˆç‰©
  abstract?: string;                   // æ‘˜è¦
  summary?: string;                    // ç”¨æˆ·æ€»ç»“
  doi?: string;                        // DOI
  url?: string;                        // URL
  pdfPath?: string;                    // PDFè·¯å¾„
  
  // è§£æå†…å®¹
  parsedContent?: {
    extractedText?: string;            // æå–æ–‡æœ¬
    extractedReferences?: any[];       // è§£æå¼•ç”¨
  };
  
  // åç«¯é›†æˆ
  backendTask?: BackendTask;           // åç«¯ä»»åŠ¡çŠ¶æ€
  
  // å…ƒæ•°æ®
  topics?: string[];                   // ä¸»é¢˜æ ‡ç­¾
  associatedSessions?: string[];       // å…³è”ä¼šè¯
  createdAt: Date;
  updatedAt?: Date;
}
```

#### **LiteratureTree (æ–‡çŒ®æ ‘)**
```typescript
interface LiteratureTree {
  id: string;
  name: string;
  rootNodeId: string;
  nodes: Record<string, MCTSNode>;     // MCTSèŠ‚ç‚¹æ˜ å°„
  createdAt: Date;
}
```

#### **Citation (å¼•æ–‡å…³ç³»)**
```typescript
interface Citation {
  id?: number;                         // è‡ªå¢ID
  sourceItemId: string;                // æºæ–‡çŒ®ID
  targetItemId: string;                // ç›®æ ‡æ–‡çŒ®ID
  createdAt: Date;
}
```

### ğŸ› ï¸ æ ¸å¿ƒæœåŠ¡åŠŸèƒ½

#### **LibraryService ä¸»è¦åŠŸèƒ½** (1000+ lines)
1. **åŸºç¡€CRUD** - å¢åˆ æ”¹æŸ¥æ–‡çŒ®æ¡ç›®
2. **æ™ºèƒ½å»é‡** - åŸºäºURL/DOI/æ ‡é¢˜/ä½œè€…çš„æ™ºèƒ½åŒ¹é…
3. **æ•°æ®åˆå¹¶** - é‡å¤æ–‡çŒ®çš„æ™ºèƒ½åˆå¹¶ç­–ç•¥
4. **æœç´¢ç­›é€‰** - å¤šå­—æ®µå…¨æ–‡æœç´¢
5. **å¼•æ–‡ç®¡ç†** - è‡ªåŠ¨/æ‰‹åŠ¨å¼•æ–‡é“¾æ¥
6. **æ•°æ®å¯¼å…¥å¯¼å‡º** - JSONæ ¼å¼æ‰¹é‡æ“ä½œ
7. **ç»Ÿè®¡åˆ†æ** - æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯
8. **ä¸»é¢˜ç®¡ç†** - Topicsæ ‡ç­¾ç®¡ç†
9. **åç«¯åŒæ­¥** - ä¸åç«¯æ•°æ®åŒæ­¥

#### **æ™ºèƒ½åŒ¹é…ç³»ç»Ÿ**
- **MatchingEngine** - åŸºäºå¤šç§ç­–ç•¥çš„æ–‡çŒ®åŒ¹é…
- **CitationLinker** - è‡ªåŠ¨å¼•æ–‡å…³ç³»å»ºç«‹
- **ReferenceExtractor** - å¼•ç”¨æ•°æ®æå–
- **SimilarityCalculator** - æ–‡æœ¬ç›¸ä¼¼åº¦è®¡ç®—

---

## ğŸ¯ æ–°æ¶æ„è®¾è®¡æ–¹æ¡ˆ

### ğŸ“ Feature-First æ–‡ä»¶ç»“æ„

åŸºäºé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼Œå°†æ–‡çŒ®ç®¡ç†é‡æ„ä¸ºç‹¬ç«‹çš„ **Literature** é¢†åŸŸï¼š

```
src/features/literature/
â”œâ”€â”€ data-access/                    # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ library-item.types.ts  # æ–‡çŒ®æ¡ç›®ç±»å‹
â”‚   â”‚   â”œâ”€â”€ citation.types.ts      # å¼•æ–‡å…³ç³»ç±»å‹
â”‚   â”‚   â”œâ”€â”€ literature-tree.types.ts # æ–‡çŒ®æ ‘ç±»å‹
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ literature-database.ts # Dexieæ•°æ®åº“å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ migration-manager.ts   # ç‰ˆæœ¬è¿ç§»ç®¡ç†
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”œâ”€â”€ library-repository.ts  # æ–‡çŒ®ä»“å‚¨
â”‚   â”‚   â”œâ”€â”€ citation-repository.ts # å¼•æ–‡ä»“å‚¨
â”‚   â”‚   â”œâ”€â”€ tree-repository.ts     # æ–‡çŒ®æ ‘ä»“å‚¨
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ matching-engine.ts     # æ™ºèƒ½åŒ¹é…å¼•æ“
â”‚   â”‚   â”œâ”€â”€ citation-linker.ts     # å¼•æ–‡é“¾æ¥å™¨
â”‚   â”‚   â”œâ”€â”€ reference-extractor.ts # å¼•ç”¨æå–å™¨
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”œâ”€â”€ library-store.ts       # æ–‡çŒ®çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ citation-store.ts      # å¼•æ–‡çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ index.ts                   # ç»Ÿä¸€å¯¼å‡º
â”œâ”€â”€ components/                     # UIç»„ä»¶
â”‚   â”œâ”€â”€ LibraryList/
â”‚   â”œâ”€â”€ LiteratureItem/
â”‚   â”œâ”€â”€ AddLiteratureForm/
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ hooks/                          # è‡ªå®šä¹‰Hooks
â”‚   â”œâ”€â”€ use-library.ts
â”‚   â”œâ”€â”€ use-citations.ts
â”‚   â””â”€â”€ index.ts
â””â”€â”€ index.ts                        # åŠŸèƒ½å¯¼å‡º
```

### ğŸ—ï¸ åˆ†å±‚æ¶æ„è®¾è®¡

#### **å±‚çº§ 1: Types Layer (ç±»å‹å®šä¹‰å±‚)**
- åŸºäºZod Schemaçš„ç±»å‹å®šä¹‰
- è¿è¡Œæ—¶æ•°æ®éªŒè¯
- TypeScriptç±»å‹æ¨å¯¼

#### **å±‚çº§ 2: Database Layer (æ•°æ®åº“å±‚)**
- Dexie.jså°è£…
- ç‰ˆæœ¬è¿ç§»ç®¡ç†
- ç´¢å¼•ä¼˜åŒ–

#### **å±‚çº§ 3: Repository Layer (ä»“å‚¨å±‚)**
- åŸºç¡€CRUDæ“ä½œ
- æ•°æ®è®¿é—®æŠ½è±¡
- äº‹åŠ¡ç®¡ç†

#### **å±‚çº§ 4: Service Layer (æœåŠ¡å±‚)**
- ä¸šåŠ¡é€»è¾‘å®ç°
- æ™ºèƒ½åŒ¹é…ç®—æ³•
- å¼•æ–‡å…³ç³»ç®¡ç†

#### **å±‚çº§ 5: Store Layer (çŠ¶æ€ç®¡ç†å±‚)**
- Zustandå“åº”å¼çŠ¶æ€
- æœ¬åœ°ç¼“å­˜ç®¡ç†
- UIçŠ¶æ€åŒæ­¥

### ğŸ“Š æ–°æ•°æ®æµæ¶æ„

```mermaid
graph TB
    subgraph "UI Layer"
        A1[LibraryList]
        A2[LiteratureItem]
        A3[AddLiteratureForm]
    end
    
    subgraph "Hooks Layer"
        B1[use-library]
        B2[use-citations]
    end
    
    subgraph "Store Layer (Zustand)"
        C1[library-store]
        C2[citation-store]
    end
    
    subgraph "Service Layer"
        D1[matching-engine]
        D2[citation-linker]
        D3[reference-extractor]
    end
    
    subgraph "Repository Layer"
        E1[library-repository]
        E2[citation-repository]
        E3[tree-repository]
    end
    
    subgraph "Database Layer (Dexie)"
        F1[literature-database]
        F2[IndexedDB]
    end
    
    A1 --> B1
    A2 --> B1
    A3 --> B1
    
    B1 --> C1
    B2 --> C2
    
    C1 --> D1
    C1 --> D2
    C2 --> D2
    
    D1 --> E1
    D2 --> E2
    D3 --> E1
    
    E1 --> F1
    E2 --> F1
    E3 --> F1
    
    F1 --> F2
```

---

## ğŸ”„ è¿ç§»å®æ–½è®¡åˆ’

### **é˜¶æ®µä¸€: åŸºç¡€æ¶æ„æ­å»º** (é¢„è®¡2-3å°æ—¶)
1. âœ… åˆ›å»ºLiteratureé¢†åŸŸç›®å½•ç»“æ„
2. âœ… è¿ç§»ç±»å‹å®šä¹‰ (types/)
3. âœ… é‡æ„æ•°æ®åº“å±‚ (database/)
4. âœ… å®ç°åŸºç¡€ä»“å‚¨ (repositories/)

### **é˜¶æ®µäºŒ: æ ¸å¿ƒæœåŠ¡è¿ç§»** (é¢„è®¡3-4å°æ—¶)
1. âœ… é‡æ„æ™ºèƒ½åŒ¹é…å¼•æ“ (matching-engine.ts)
2. âœ… é‡æ„å¼•æ–‡é“¾æ¥å™¨ (citation-linker.ts)
3. âœ… é‡æ„å¼•ç”¨æå–å™¨ (reference-extractor.ts)
4. âœ… å®ç°çŠ¶æ€ç®¡ç† (stores/)

### **é˜¶æ®µä¸‰: UIé›†æˆå’Œæµ‹è¯•** (é¢„è®¡2-3å°æ—¶)
1. âœ… åˆ›å»ºè‡ªå®šä¹‰Hooks (hooks/)
2. âœ… é‡æ„UIç»„ä»¶ (components/)
3. âœ… é›†æˆæµ‹è¯•å’Œè°ƒè¯•
4. âœ… æ€§èƒ½ä¼˜åŒ–

### **é˜¶æ®µå››: é«˜çº§åŠŸèƒ½** (é¢„è®¡1-2å°æ—¶)
1. âœ… æ‰¹é‡æ“ä½œä¼˜åŒ–
2. âœ… æœç´¢æ€§èƒ½æå‡
3. âœ… æ•°æ®å¯¼å…¥å¯¼å‡º
4. âœ… é”™è¯¯å¤„ç†å®Œå–„

---

## ğŸ“ˆ æ¶æ„ä¼˜åŠ¿

### **ç›¸æ¯”åŸæ¶æ„çš„æ”¹è¿›**
1. **æ¨¡å—åŒ–ç¨‹åº¦æ›´é«˜** - æ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹å¯æµ‹è¯•
2. **èŒè´£åˆ†ç¦»æ›´æ¸…æ™°** - Repository vs Service vs Storeæ˜ç¡®åˆ†å·¥
3. **æ‰©å±•æ€§æ›´å¼º** - æ–°åŠŸèƒ½æ˜“äºæ’å…¥
4. **ç±»å‹å®‰å…¨æ€§æ›´å¥½** - å…¨é“¾è·¯TypeScriptæ”¯æŒ
5. **æ€§èƒ½ä¼˜åŒ–** - æ›´ç²¾ç»†çš„çŠ¶æ€ç®¡ç†å’Œç¼“å­˜ç­–ç•¥

### **ä¿æŒçš„æ ¸å¿ƒä¼˜åŠ¿**
1. **æ™ºèƒ½å»é‡** - ä¿ç•™MatchingEngineæ ¸å¿ƒç®—æ³•
2. **å¼•æ–‡ç®¡ç†** - ä¿ç•™CitationLinkerå®Œæ•´åŠŸèƒ½
3. **æ•°æ®æŒä¹…åŒ–** - ç»§ç»­ä½¿ç”¨Dexie + IndexedDB
4. **ç‰ˆæœ¬è¿ç§»** - ä¿ç•™æ•°æ®åº“å‡çº§æœºåˆ¶

---

## ğŸš€ å®æ–½ä¼˜å…ˆçº§

### **é«˜ä¼˜å…ˆçº§** (ç«‹å³å¼€å§‹)
- [x] âœ… ç›®å½•ç»“æ„åˆ›å»º
- [ ] ğŸ”„ ç±»å‹å®šä¹‰è¿ç§»
- [ ] ğŸ”„ æ•°æ®åº“å±‚é‡æ„  
- [ ] ğŸ”„ åŸºç¡€ä»“å‚¨å®ç°

### **ä¸­ä¼˜å…ˆçº§** (ç¬¬äºŒé˜¶æ®µ)
- [ ] â³ æ™ºèƒ½åŒ¹é…å¼•æ“
- [ ] â³ å¼•æ–‡é“¾æ¥å™¨
- [ ] â³ çŠ¶æ€ç®¡ç†å±‚

### **ä½ä¼˜å…ˆçº§** (æœ€åå®Œå–„)
- [ ] â³ UIç»„ä»¶é‡æ„
- [ ] â³ æ€§èƒ½ä¼˜åŒ–
- [ ] â³ æµ‹è¯•å®Œå–„

---

## ğŸ“ æŠ€æœ¯å†³ç­–è®°å½•

### **ä¿ç•™çš„æŠ€æœ¯æ ˆ**
- âœ… **Dexie.js** - æˆç†Ÿçš„IndexedDBæŠ½è±¡å±‚
- âœ… **Zod** - è¿è¡Œæ—¶ç±»å‹éªŒè¯
- âœ… **TypeScript** - é™æ€ç±»å‹æ£€æŸ¥
- âœ… **Zustand** - è½»é‡çº§çŠ¶æ€ç®¡ç†

### **æ¶æ„æ¨¡å¼é€‰æ‹©**
- âœ… **Repository Pattern** - æ•°æ®è®¿é—®æŠ½è±¡
- âœ… **Service Layer** - ä¸šåŠ¡é€»è¾‘å°è£…
- âœ… **Domain-Driven Design** - é¢†åŸŸé©±åŠ¨è®¾è®¡
- âœ… **Feature-First** - åŠŸèƒ½ä¼˜å…ˆç»„ç»‡

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**ç«‹å³å¼€å§‹**: åŸºç¡€æ¶æ„æ­å»º
1. åˆ›å»º `src/features/literature/` ç›®å½•ç»“æ„
2. è¿ç§»ç±»å‹å®šä¹‰åˆ°æ–°æ¶æ„
3. é‡æ„æ•°æ®åº“å±‚å’Œä»“å‚¨å±‚
4. é€æ­¥è¿ç§»æ ¸å¿ƒæœåŠ¡

**é¢„æœŸæˆæœ**: 
- å®Œæ•´çš„Feature-Firstæ–‡çŒ®ç®¡ç†é¢†åŸŸ
- ä¿ç•™æ‰€æœ‰ç°æœ‰åŠŸèƒ½
- æ›´å¥½çš„ä»£ç ç»„ç»‡å’Œå¯ç»´æŠ¤æ€§
- ä¸ºåç»­åŠŸèƒ½æ‰©å±•æ‰“ä¸‹åšå®åŸºç¡€

---

> ğŸ“… **åˆ›å»ºæ—¶é—´**: 2025-01-30  
> ğŸ”„ **æœ€åæ›´æ–°**: 2025-01-30  
> ğŸ‘¥ **è´Ÿè´£äºº**: Literature Management Team  
> ğŸ“‹ **çŠ¶æ€**: âœ… åˆ†æå®Œæˆï¼ŒğŸ”„ å¾…å®æ–½
