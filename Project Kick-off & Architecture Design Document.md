
## **项目文档：Research Navigator - 前端架构设计**

### **1. 项目概览 (Project Overview)**

#### **1.1 项目愿景 (Vision)**

“Research Navigator” 是一款旨在革新科研人员工作流程的 Web 应用。它将强大的 AI 能力（如文献分析、思路生成、草稿撰写）与直观的知识管理工具（如思维导图式的文献树、结构化笔记）深度融合，打造一个无缝、高效、智能的云端科研环境。用户可以在一个平台上完成从文献检索、阅读分析到论文撰写的全过程，并与团队成员实时协同。

#### **1.2 核心功能模块 (Core Features)**

*   **项目工作区 (Project Workspace):** 以项目为单位组织所有科研资料的核心视图。
*   **AI 对话与驱动 (AI Dialogue & Driver):** 与 AI 进行多轮对话，驱动文献查找、分析、内容生成等任务。
*   **文献树 (Literature Tree):** 以思维导图的形式可视化和组织相关文献，展现知识脉络。
*   **文献库 (Global Library):** 集中管理用户所有收藏的文献资料。
*   **协同编辑 (Collaborative Editing):** 支持多人实时编辑笔记、草稿等内容。
*   **持久化与云同步 (Persistence & Cloud Sync):** 所有工作进度在本地快速响应，并实时同步至云端，确保数据安全不丢失。

---

### **2. 技术选型 (Technology Stack)**

| 类别           | 技术/库                          | 理由                                                                                           |
| -------------- | -------------------------------- | ---------------------------------------------------------------------------------------------- |
| **核心框架**   | Next.js (App Router)             | 提供强大的路由、SSR/SSG能力，优化首屏加载，并拥有活跃的生态系统。                              |
| **语言**       | TypeScript                       | 提供静态类型检查，增强代码健壮性和可维护性，是大型项目的基石。                                 |
| **UI 组件库**  | Shadcn/UI & Tailwind CSS         | 提供高质量、可访问的UI组件基础，通过Tailwind CSS实现高度可定制的原子化样式，确保设计统一性。   |
| **状态管理**   | Zustand                          | 轻量、简洁、非侵入式。通过Hooks API与React无缝集成，避免了模板代码，易于实现模块化（Slices）。 |
| **数据校验**   | Zod                              | 提供从类型定义到运行时校验的一体化方案，确保前后端及应用内部数据流的类型安全。                 |
| **数据请求**   | Axios                            | 成熟的HTTP客户端，支持拦截器等高级功能，便于统一处理API请求和响应。                            |
| **本地持久化** | IndexedDB (通过 `dexie.js` 封装) | 提供大容量的浏览器端结构化存储，实现离线可用和快速响应的用户体验。`dexie.js`简化了其复杂API。  |
| **实时通信**   | Socket.IO / SSE                  | 用于处理与后端的实时双向/单向通信，如AI生成进度更新、协同通知等。                              |
| **代码规范**   | ESLint & Prettier                | 统一代码风格和规范，自动化格式化，提升代码质量和团队协作效率。                                 |

---

### **3. 核心设计原则与约束 (Core Design Principles & Constraints)**

**这是指导 AI Agent 生成代码时必须遵守的“铁律”。**

1.  **严格分层 (Strict Layering):**
    *   应用必须遵循 `展现层 -> 状态管理层 -> 服务层 -> 基础支撑层` 的分层架构。
    *   **约束:** 上层可以调用下层，但下层**绝不允许**导入或依赖上层模块。例如，`services` 目录下的文件不能 `import` 任何来自 `components` 或 `stores` 的内容。

2.  **单向数据流 (Unidirectional Data Flow):**
    *   用户交互触发 `Action` -> `State` 更新 -> `UI` 重新渲染。
    *   服务器推送数据通过 `Service Layer` 触发 `Action`，同样遵循此流程。
    *   **约束:** 任何状态的变更**必须**通过 Zustand Store 中定义的 Action 来完成。严禁在组件或服务中直接修改状态。

3.  **服务层作为业务逻辑的唯一入口 (Service Layer as the Single Source of Business Logic):**
    *   所有与后端 API 的交互、复杂的业务规则、数据转换和处理逻辑，都**必须**封装在 `Service Layer` (`src/services/*`) 中。
    *   **约束:** React 组件和 Zustand Store **不应**包含复杂的业务逻辑。Store 的职责是协调，组件的职责是渲染。

4.  **“笨”组件，"聪明" Hooks ("Dumb" Components, "Smart" Hooks):**
    *   UI 组件应尽可能保持为纯粹的展示性组件，接收 `props` 并渲染，通过回调函数与外部通信。
    *   组件内部的复杂状态逻辑（如表单状态、动画控制）应抽取到自定义 Hooks (`src/hooks/*`) 中。

5.  **类型安全优先 (Type-Safety First):**
    *   所有的数据模型（特别是与 API 交互的数据）**必须**在 `src/models/schema.ts` 中使用 Zod 定义 Schema。
    *   **约束:** 在 `Service Layer` 中接收到 API 响应后，必须立即使用对应的 Zod Schema 进行解析（`.parse()`），确保进入应用内部的数据是类型安全的。

6.  **配置驱动的 UI (Configuration-Driven UI):**
    *   应用的视觉风格（颜色、字体、间距等）应在 `src/lib/theme.ts` (或 `tailwind.config.js`) 中统一配置。
    *   **约束:** 组件样式应优先使用主题配置中定义的变量，避免硬编码颜色值或尺寸。

---

### **4. 应用架构与文件结构 (Application Architecture & Folder Structure)**

*(这部分直接复用并强化我们之前的讨论)*

#### **4.1 逻辑分层图**

```plaintext
      ┌──────────────────────────────────────────┐
      │         (1) 展现层 (Presentation)        │
      │    src/app, src/components, src/hooks    │
      └────────────────────▲─────────────────────┘
                           │ (Actions, State)
      ┌────────────────────▼─────────────────────┐
      │     (2) 状态管理层 (State Management)    │
      │               src/stores                 │
      └────────────────────▲─────────────────────┘
                           │ (Service Calls)
      ┌────────────────────▼─────────────────────┐
      │         (3) 服务层 (Service Layer)       │
      │              src/services                │
      └────────────────────▲─────────────────────┘
                           │ (Dependencies)
      ┌────────────────────▼─────────────────────┐
      │   (4) 基础支撑层 (Infrastructure)        │
      │ src/models, src/lib, src/constants       │
      └──────────────────────────────────────────┘
```

#### **4.2 文件结构详解**

```
src/
├── app/              # 路由与页面 (展现层)
├── components/       # 全局可复用UI组件 (展现层)
│   ├── ui/           # 基础原子组件 (e.g., Button, Input)
│   └── features/     # 特定功能的复杂组件集合 (e.g., ChatPanel)
├── constants/        # 应用常量 (支撑层)
├── hooks/            # 自定义React Hooks (展现层)
├── lib/              # 辅助函数与工具库 (支撑层)
│   ├── utils.ts      # 通用工具
│   └── theme.ts      # UI主题配置
├── models/           # Zod Schemas & TypeScript Types (支撑层)
│   └── schema.ts     # 数据模型的“单一事实来源”
├── services/         # 业务逻辑与数据交互 (服务层)
│   ├── api.ts        # Axios 实例与配置
│   ├── db.ts         # IndexedDB 客户端封装
│   ├── realtime.ts   # WebSocket/SSE 连接管理器
│   └── *.service.ts  # 按功能划分的服务 (e.g., project.service.ts)
└── stores/           # Zustand 状态管理 (状态管理层)
    ├── *.slice.ts    # 按功能划分的状态切片
    └── useRootStore.ts # 组合所有Slices
```


#### **详细图**
      ┌──────────────────────────────────────────────────┐
      │             👤 用户交互 (User Interaction)         │
      └─────────────────────────▲────────────────────────┘
                                │ (React Events)
                                │
      ┌─────────────────────────▼────────────────────────┐
      │ (1) 展现层 (Presentation Layer)                    │
      │ ------------------------------------------------ │
      │   ● UI Components (React/Next.js)                │
      │   ● Hooks (自定义钩子)                             │
      │   ● 职责：渲染状态，捕捉用户输入，调用Actions。      │
      │   ● "我只负责长什么样和用户点了什么。"              │
      └─────────────────────────▲────────────────────────┘
                                │ (调用Actions, 订阅State)
                                │
      ┌─────────────────────────▼────────────────────────┐
      │ (2) 状态管理层 (State Management Layer)            │
      │ ------------------------------------------------ │
      │   ● Zustand Store (Slices)                       │
      │   ● 职责：存储应用UI状态，提供更新状态的Actions。   │
      │           作为“协调者”调用服务层。                 │
      │   ● "我是UI状态的唯一来源，并负责指挥数据服务。"      │
      └─────────────────────────▲────────────────────────┘
                                │ (调用服务方法)
                                │
      ┌─────────────────────────▼────────────────────────┐
      │ (3) 服务层 (Service Layer)                         │
      │ ------------------------------------------------ │
      │   ● Services (e.g., projectService, authService) │
      │   ● 职责：封装所有业务逻辑和数据获取/持久化逻辑。    │
      │           与后端API、WebSocket、IndexedDB等通信。   │
      │   ● "所有脏活累活(业务逻辑/数据读写)都交给我。"     │
      └─────────────────────────▲────────────────────────┘
                                │ (使用模型/工具/API客户端)
                                │
   ┌────────────────────────────┼───────────────────────────┐
   │                            │                           │
┌──▼────────────────┐  ┌────────▼──────────┐  ┌─────────────▼──────────┐
│ (4a) 模型与校验层 │  │ (4b) 工具/库层      │  │ (4c) 数据源适配层      │
│ ----------------- │  │ ----------------- │  │ ---------------------- │
│ ● Zod Schemas     │  │ ● utils.ts        │  │ ● api.ts (Axios)       │
│ ● TypeScript Types│  │ ● theme.ts        │  │ ● db.ts (Dexie.js)     │
│ ● 职责：定义数据   │  │ ● 纯算法函数        │  │ ● realtime.ts (Socket) │
│   结构和有效性。  │  │ ● 职责：提供无副作  │  │ ● 职责：封装与具体数据 │
│ ● "我是数据的蓝图"│  │   用的、可复用的    │  │   源通信的技术细节。   │
│                   │  │   功能。            │  │ ● "我只管如何收发字节" │
│                   │  │ ● "我是工具箱"      │  │                        │
└───────────────────┘  └───────────────────┘  └────────────────────────┘
                                │
                                │ (HTTP/WS/DB Protocols)
                                │
      ┌─────────────────────────▼────────────────────────┐
      │             🌐 外部数据源 (External Sources)         │
      │ ------------------------------------------------ │
      │   ● Backend API                                  │
      │   ● WebSocket/SSE Server                         │
      │   ● Browser IndexedDB                            │
      └──────────────────────────────────────────────────┘
