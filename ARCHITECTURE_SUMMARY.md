# ğŸ—ï¸ Research Navigator æ¶æ„æ–‡æ¡£

> **ç‰ˆæœ¬**: v2.0
> **çŠ¶æ€**: âœ… æ ¸å¿ƒæ¶æ„å®šä¹‰å®Œæˆ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº† Research Navigator v2.0 çš„æ ¸å¿ƒè½¯ä»¶æ¶æ„ã€‚è¯¥æ¶æ„é‡‡ç”¨**é¢†åŸŸé©±åŠ¨è®¾è®¡ (DDD)** å’Œ**å‚ç›´åˆ‡ç‰‡ (Vertical Slices)** çš„æ€æƒ³ï¼Œå°†ä»£ç æŒ‰ä¸šåŠ¡é¢†åŸŸè€ŒéæŠ€æœ¯ç±»å‹è¿›è¡Œç»„ç»‡ï¼Œæ—¨åœ¨å»ºç«‹ä¸€ä¸ªé«˜å†…èšã€ä½è€¦åˆã€å¯æ‰©å±•ã€æ˜“äºç»´æŠ¤çš„ä»£ç åº“ã€‚

---

## ğŸ—ï¸ åº”ç”¨æ¶æ„ä¾èµ–è§„åˆ™ (The Onion Architecture)

æˆ‘ä»¬çš„åº”ç”¨éµå¾ªä¸¥æ ¼çš„**å•å‘ä¾èµ–åŸåˆ™**ï¼Œå¯ä»¥æƒ³è±¡æˆä¸€ä¸ªå››å±‚åŒå¿ƒåœ†ï¼ˆæ´‹è‘±ï¼‰ç»“æ„ã€‚ä¾èµ–å…³ç³»åªèƒ½ä»å¤–å±‚æŒ‡å‘å†…å±‚ï¼Œå†…å±‚ç»ä¸èƒ½çŸ¥é“å¤–å±‚çš„å­˜åœ¨ã€‚

```
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Layer 4: app/ (è·¯ç”±ä¸é¡µé¢ç»„è£…å±‚)                     â”‚
          â”‚      ä¾èµ–äº â†“                                       â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
          â”‚  Layer 3: components/ (é€šç”¨UIä¸å¸ƒå±€å±‚)                â”‚
          â”‚      ä¾èµ–äº â†“                                       â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
          â”‚  Layer 2: features/ (ä¸šåŠ¡é¢†åŸŸæ ¸å¿ƒå±‚)                  â”‚
          â”‚      ä¾èµ–äº â†“                                       â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
          â”‚  Layer 1: lib/ (åŸºç¡€è®¾æ–½ä¸æ ¸å¿ƒæ¨¡å‹å±‚)                 â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

*   **ä¾èµ–è§„åˆ™**: **å¤–å±‚å¯ä»¥ä¾èµ–å†…å±‚ï¼Œå†…å±‚ç»ä¸èƒ½ä¾èµ–å¤–å±‚ã€‚**
    *   âœ… **å…è®¸**: `app/` å¯¼å…¥ `features/` å’Œ `components/`ã€‚
    *   âœ… **å…è®¸**: `features/` å¯¼å…¥ `lib/`ã€‚
    *   ğŸš« **ç¦æ­¢**: `lib/` å¯¼å…¥ `features/`ã€‚
    *   ğŸš« **ç¦æ­¢**: `features/` ä¹‹é—´äº’ç›¸å¯¼å…¥ï¼ˆé™¤éé€šè¿‡æ˜ç¡®çš„é›†æˆå±‚ï¼Œå¦‚ `session` é¢†åŸŸï¼‰ã€‚
*   **ç‰¹æ®Šå±‚**: `providers/` ç›®å½•æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å­˜åœ¨ï¼Œå®ƒä¸ºæ•´ä¸ªåº”ç”¨æä¾›é¡¶å±‚ä¸Šä¸‹æ–‡ï¼Œé€šå¸¸åœ¨æœ€å¤–å±‚çš„ `app/layout.tsx` ä¸­ä½¿ç”¨ã€‚

---

## ğŸ“‚ æ–‡ä»¶ç»“æ„è¯¦è§£ (Directory Breakdown)

#### `app/` - è·¯ç”±ä¸é¡µé¢ç»„è£…å±‚ (The "What")
*   **æ ¸å¿ƒèŒè´£**: å®šä¹‰åº”ç”¨çš„ URL è·¯ç”±ç»“æ„ï¼Œå¹¶å°†æ¥è‡ª `features` å’Œ `components` çš„æ¨¡å—ç»„è£…æˆç”¨æˆ·å¯è§çš„é¡µé¢ã€‚
*   **åŒ…å«å†…å®¹**: Next.js App Router çš„ä¿ç•™æ–‡ä»¶ï¼Œå¦‚ `page.tsx`, `layout.tsx`, `loading.tsx`ã€‚
*   **å…³é”®åŸåˆ™**: **ä¿æŒé¡µé¢â€œè–„â€**ã€‚æ­¤ç›®å½•ä¸‹çš„æ–‡ä»¶åº”ä¸“æ³¨äºå¸ƒå±€å’Œç»„è£…ï¼Œé¿å…åŒ…å«å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œ`app/literature/library/page.tsx` ä¼šå¯¼å…¥å¹¶æ¸²æŸ“æ¥è‡ª `features/literature/management` çš„ç»„ä»¶ã€‚

#### `features/` - ä¸šåŠ¡é¢†åŸŸæ ¸å¿ƒå±‚ (The "How")
*   **æ ¸å¿ƒèŒè´£**: å®ç°åº”ç”¨æ‰€æœ‰çš„æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½ã€‚è¿™æ˜¯åº”ç”¨çš„â€œå¿ƒè„å’Œå¤§è„‘â€ï¼Œæ¯ä¸ªå­ç›®å½•ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„ä¸šåŠ¡é¢†åŸŸã€‚
*   **åŒ…å«å†…å®¹**:
    *   **é¢†åŸŸæ–‡ä»¶å¤¹ (e.g., `literature/`, `research-tree/`)**: ä»£è¡¨ä¸€ä¸ªå®Œæ•´çš„ä¸šåŠ¡åŠŸèƒ½ã€‚
    *   `data-access/`: **æ•°æ®è®¿é—®å±‚**ã€‚å°è£…äº†ä¸æ•°æ®æºï¼ˆAPI, Dexieï¼‰çš„äº¤äº’å’ŒçŠ¶æ€ç®¡ç†ï¼ˆZustandï¼‰ã€‚è¿™æ˜¯å–ä»£ä¼ ç»Ÿå…¨å±€ `services` çš„ç°ä»£æ¨¡å¼ã€‚
        *   `*-types.ts`: å®šä¹‰**ä»…æ­¤é¢†åŸŸä½¿ç”¨**çš„ç‰¹å®šç±»å‹ã€‚
        *   `*-store.ts`: Zustand storeï¼Œç®¡ç†é¢†åŸŸçš„å†…å­˜çŠ¶æ€ï¼Œä¾› UI å“åº”å¼æ›´æ–°ã€‚
        *   `*-repository.ts`: æ•°æ®ä»“åº“ï¼Œå°è£…å¯¹ `lib/db` (Dexie) çš„æ‰€æœ‰ CRUD æ“ä½œï¼Œæ˜¯æŒä¹…åŒ–é€»è¾‘çš„å”¯ä¸€å…¥å£ã€‚
    *   `management/`, `details/`, `visualization/`: **åŠŸèƒ½åˆ‡ç‰‡ (Slices)**ã€‚å°†ä¸€ä¸ªå¤§é¢†åŸŸæŒ‰å…·ä½“ç”¨ä¾‹è¿›ä¸€æ­¥ç»†åˆ†ï¼Œæ¯ä¸ªåˆ‡ç‰‡åŒ…å«å…¶è‡ªèº«çš„ç»„ä»¶å’Œé€»è¾‘ã€‚
*   **å…³é”®åŸåˆ™**: **é«˜å†…èšï¼Œä½è€¦åˆ**ã€‚ä¸€ä¸ªé¢†åŸŸåº”è¯¥å¯ä»¥è¢«ç‹¬ç«‹ç†è§£å’Œå¼€å‘ï¼Œå¯¹å…¶ä»–é¢†åŸŸçš„ä¾èµ–é™åˆ°æœ€ä½ã€‚

#### `components/` - é€šç”¨UIä¸å¸ƒå±€å±‚ (The "Look")
*   **æ ¸å¿ƒèŒè´£**: æä¾›å…¨å±€å¯å¤ç”¨ã€**å®Œå…¨ä¸å«ä¸šåŠ¡é€»è¾‘**çš„ UI ç»„ä»¶ã€‚
*   **åŒ…å«å†…å®¹**:
    *   `ui/`: **åŸå­ç»„ä»¶**ã€‚è®¾è®¡ç³»ç»Ÿçš„åŸºç¡€ï¼Œå¦‚ `Button.tsx`, `Input.tsx`, `Dialog.tsx`ã€‚å®ƒä»¬æ˜¯çº¯ç²¹çš„å±•ç¤ºç»„ä»¶ï¼ˆä¹Ÿç§°â€œå“‘â€ç»„ä»¶ï¼‰ã€‚
    *   `layout/`: **ç»“æ„æ€§ç»„ä»¶**ã€‚å®šä¹‰åº”ç”¨çš„æ•´ä½“é¡µé¢ç»“æ„ï¼Œå¦‚ `PageWrapper.tsx`ã€‚æ³¨æ„ï¼šåœ¨ä½ çš„æ–°è®¾è®¡ä¸­ï¼Œ`Header` å’Œ `Sidebar` å·²è¢«ç§»å…¥ `features/session/layout`ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„å†³ç­–ï¼Œå› ä¸ºå®ƒä»¬ä¸â€œä¼šè¯â€è¿™ä¸ªä¸šåŠ¡é¢†åŸŸç´§å¯†ç›¸å…³ã€‚
*   **å…³é”®åŸåˆ™**: **ä¸šåŠ¡æ— å…³æ€§**ã€‚è¿™é‡Œçš„ç»„ä»¶å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼Œå®ƒä»¬ä¸çŸ¥é“è‡ªå·±å°†è¢«ç”¨æ¥æ˜¾ç¤ºâ€œæ–‡çŒ®â€è¿˜æ˜¯â€œç”¨æˆ·è®¾ç½®â€ã€‚

#### `lib/` - åŸºç¡€è®¾æ–½ä¸æ ¸å¿ƒæ¨¡å‹å±‚ (The "Foundation")
*   **æ ¸å¿ƒèŒè´£**: æä¾›æ•´ä¸ªåº”ç”¨å…±äº«çš„ã€ä¸å…·ä½“ä¸šåŠ¡åŠŸèƒ½æ— å…³çš„åŸºç¡€è®¾æ–½ã€å·¥å…·å’Œæ ¸å¿ƒæ•°æ®æ¨¡å‹ã€‚
*   **åŒ…å«å†…å®¹**:
    *   `db/`, `api/`: æ•°æ®æºçš„å®¢æˆ·ç«¯å®ä¾‹é…ç½®ï¼ˆå¦‚ Dexie å®ä¾‹, Axios å®ä¾‹ï¼‰ã€‚
    *   `types/`: **æ ¸å¿ƒé¢†åŸŸå®ä½“ (Entities)**ã€‚å®šä¹‰è·¨è¶Šå¤šä¸ª Feature çš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œå¦‚ `User`, `Project`ã€‚
    *   `utils/`: é€šç”¨ã€çº¯ç²¹çš„è¾…åŠ©å‡½æ•°åº“ï¼Œå¦‚ `formatDate()`, `cn()`ã€‚
*   **å…³é”®åŸåˆ™**: **ç»å¯¹ç¨³å®šå’Œç‹¬ç«‹**ã€‚`lib` æ˜¯åº”ç”¨çš„åœ°åŸºï¼Œå®ƒä¸èƒ½ä¾èµ–ä»»ä½•å…¶ä»–ä¸Šå±‚ç›®å½• (`features`, `components`, `app`)ã€‚

#### `providers/` - å…¨å±€ä¸Šä¸‹æ–‡å±‚ (The "Context")
*   **æ ¸å¿ƒèŒè´£**: å°è£…éœ€è¦åœ¨åº”ç”¨æ ¹ç»„ä»¶ï¼ˆ`app/layout.tsx`ï¼‰ä¸­ä½¿ç”¨çš„å…¨å±€ä¸Šä¸‹æ–‡æä¾›è€… (Context Providers)ã€‚
*   **åŒ…å«å†…å®¹**: `ThemeProvider`, `QueryClientProvider`, `SessionProvider` (NextAuth.js) ç­‰ã€‚
*   **å…³é”®åŸåˆ™**: **æ³¨å…¥å…¨å±€èƒ½åŠ›**ã€‚å°†å®ƒä»¬åˆ†ç¦»å‡ºæ¥ï¼Œä½¿ `components` ç›®å½•çš„èŒè´£æ›´çº¯ç²¹ï¼Œä¹Ÿæ¸…æ™°åœ°è¡¨æ˜äº†è¿™äº›æ˜¯åº”ç”¨çš„é¡¶å±‚é…ç½®ã€‚

---

## ğŸ¯ æ ¸å¿ƒé¢†åŸŸç»“æ„ (`features/`)

```
src/features/
â”œâ”€â”€ ğŸ“š literature/                 # æ–‡çŒ®é¢†åŸŸ
â”‚   â”œâ”€â”€ data-access/               # æ•°æ®è®¿é—®å±‚ (Dexie + Zustand)
â”‚   â”œâ”€â”€ management/                # æ–‡çŒ®ç®¡ç†åŠŸèƒ½
â”‚   â””â”€â”€ ...
â”œâ”€â”€ ğŸŒ³ research-tree/              # ç ”ç©¶æ ‘é¢†åŸŸ
â”‚   â”œâ”€â”€ data-access/               # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ mcts-engine/               # MCTSç®—æ³•å¼•æ“ (é¢†åŸŸå†…æ ¸å¿ƒé€»è¾‘)
â”‚   â””â”€â”€ ...
â”œâ”€â”€ ğŸ’¬ session/                    # ä¼šè¯/å·¥ä½œåŒºé¢†åŸŸ (èšåˆå™¨)
â”‚   â”œâ”€â”€ core/                      # ä¼šè¯ç®¡ç†æ ¸å¿ƒ (æ•°æ®ä¸çŠ¶æ€)
â”‚   â”œâ”€â”€ layout/                    # ä¼šè¯ç›¸å…³çš„å¸ƒå±€ç»„ä»¶ (Header, Sidebar)
â”‚   â”œâ”€â”€ integrations/              # é›†æˆå…¶ä»–é¢†åŸŸï¼Œå¤„ç†è·¨é¢†åŸŸé€»è¾‘
â”‚   â””â”€â”€ ...
â”œâ”€â”€ ğŸ¨ visualization/              # é€šç”¨å¯è§†åŒ–é¢†åŸŸ
â”‚   â””â”€â”€ ...
â”œâ”€â”€ ğŸ‘¤ user/                       # ç”¨æˆ·é¢†åŸŸ
â”‚   â””â”€â”€ ...
â””â”€â”€ index.ts                      # (å¯é€‰) å¯¼å‡ºæ‰€æœ‰é¢†åŸŸï¼Œæ–¹ä¾¿ç»Ÿä¸€å¯¼å…¥
```

---

## ğŸ”„ ä¾èµ–å…³ç³»å›¾

```mermaid
graph TD
    subgraph "ä¸šåŠ¡é¢†åŸŸ (Features)"
        A[Session/Workspace] --> B[Literature]
        A --> C[Research Tree]
        C --> B
        D[General Visualization] --> A
        D --> B
        D --> C
        E[User]
    end
  
    style A fill:#e1f5fe,stroke:#333
    style B fill:#f3e5f5,stroke:#333
    style C fill:#e8f5e8,stroke:#333
    style D fill:#fff3e0,stroke:#333
    style E fill:#fce4ec,stroke:#333
```

**å…³é”®ä¾èµ–åŸåˆ™**:
- âœ… **Session â†’ Literature + Research Tree**: ä¼šè¯æ˜¯ç»„ç»‡å’Œä½¿ç”¨æ–‡çŒ®ä¸ç ”ç©¶æ ‘çš„å·¥ä½œç©ºé—´ã€‚
- âœ… **Research Tree â†’ Literature**: ç ”ç©¶æ ‘çš„èŠ‚ç‚¹å¯ä»¥å¼•ç”¨ä¸€ç¯‡æˆ–å¤šç¯‡æ–‡çŒ®ã€‚
- âœ… **Literature ä¸ Research Tree è§£è€¦**: ä¸¤è€…ä¸ç›´æ¥äº’ç›¸ä¾èµ–ï¼Œé€šè¿‡IDå¼•ç”¨å»ºç«‹æ¾æ•£è”ç³»ï¼Œæ‰€æœ‰äº¤äº’ç”±ä¸Šå±‚ï¼ˆå¦‚Sessionï¼‰åè°ƒã€‚
- âœ… **Visualization â†’ All**: å¯è§†åŒ–ä½œä¸ºä¸€ä¸ªå±•ç¤ºå±‚ï¼Œå¯ä»¥è¯»å–ä»»ä½•é¢†åŸŸçš„æ•°æ®å¹¶å°†å…¶å¯è§†åŒ–ã€‚


---

## ğŸ’¾ æ•°æ®å±‚è®¾è®¡

### æŠ€æœ¯é€‰å‹
- **Dexie (IndexedDB)**ï¼šæŒä¹…åŒ–å­˜å‚¨ï¼Œæ”¯æŒå¤æ‚æŸ¥è¯¢å’Œç´¢å¼•
- **Zustand**ï¼šå†…å­˜çŠ¶æ€ç®¡ç†ï¼Œå“åº”å¼UIæ›´æ–°
- **å¼•ç”¨å…³ç³»**ï¼šResearch TreeèŠ‚ç‚¹å­˜å‚¨Literatureçš„IDï¼Œè€Œéå®Œæ•´å¯¹è±¡

### æ•°æ®æµ
```
UI Components
     â†•
Zustand Stores (å†…å­˜çŠ¶æ€)
     â†•
Repository Layer (Dexie)
     â†•
IndexedDB (æŒä¹…åŒ–)
```

---

## ğŸ“Š æ ¸å¿ƒå®ä½“æ¨¡å‹

### Literature Domain
- `LiteratureItem`: æ–‡çŒ®æ¡ç›®
- `LiteratureCollection`: æ–‡çŒ®é›†åˆ
- `CitationRelation`: å¼•ç”¨å…³ç³»
- `LiteratureNote`: æ–‡çŒ®ç¬”è®°

### Research Tree Domain  
- `ResearchTree`: ç ”ç©¶æ ‘
- `ResearchTreeNode`: æ ‘èŠ‚ç‚¹(å¼•ç”¨Literature ID)
- `MCTSIteration`: MCTSè¿­ä»£è®°å½•
- `ResearchExpansion`: èŠ‚ç‚¹æ‰©å±•è®°å½•

### Session Domain
- `ResearchSession`: ç ”ç©¶ä¼šè¯
- `DialogueMessage`: å¯¹è¯æ¶ˆæ¯
- `SessionPreferences`: ä¼šè¯åå¥½è®¾ç½®
- `ResearchPhase`: ç ”ç©¶é˜¶æ®µ

---

## ğŸ¯ ä½¿ç”¨æ–¹å¼

### å¯¼å…¥æ–¹å¼
```typescript
// æ–¹å¼1: å¯¼å…¥ç‰¹å®šé¢†åŸŸ
import { useLiteratureStore, LiteratureItem } from '@/features/literature';
import { useResearchTreeStore, ResearchTreeNode } from '@/features/research-tree';
import { useSessionStore, ResearchSession } from '@/features/session';

// æ–¹å¼2: å¯¼å…¥æ‰€æœ‰é¢†åŸŸ
import { Literature, ResearchTree, Session } from '@/features';

// ä½¿ç”¨
const literatureStore = Literature.useLiteratureStore();
const treeStore = ResearchTree.useResearchTreeStore();
const sessionStore = Session.useSessionStore();
```

### æ•°æ®è®¿é—®
```typescript
// Literatureæ“ä½œ
const literature = useLiteratureStore();
await literatureRepository.addLiterature(newItem);
literature.addItem(newItem);

// Research Treeæ“ä½œ  
const tree = useResearchTreeStore();
await researchTreeRepository.addNode(newNode);
tree.addNode(newNode);

// Sessionæ“ä½œ
const session = useSessionStore();
session.createSession({ title: 'æ–°ç ”ç©¶', initialQuestion: 'é—®é¢˜' });
```
